<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Select Project</title>

    <script src="../static-files/jquery-3.1.1.min.js"></script>
</head>
<body>

<p>Manage existing projects:</p>
<select id="projects"></select>
<button type="button" onclick="openProject()">Open</button>
<button type="button" onclick="deleteProject()">Delete</button>
<br><br><br>
<p>Create a new project:</p>
<form id="file-form" method="POST" enctype=multipart/form-data>
    Bot name: <input type="text" id="newBotName" name="botname"><br>
    Add files (.zip file containing "flows" and "states" folders):
    <input type="file" id="file" name="file" multiple size="50"><br>
    <button type="button" onclick="createProject()">Create Project</button>
</form>


<script type="text/javascript">
    var botnames;
    jQuery.ajaxSetup({async: false});
    $.post("botnames", "getBotnames",
        function (data, status) {
            botnames = data.split(";");
            console.log("get bot names: " + status);
        });
    jQuery.ajaxSetup({async: true});

    for (i = 0; i < botnames.length; i++) {
        if (botnames[i] != "") {
            var opt = document.createElement("option");
            opt.value = botnames[i];
            opt.innerHTML = botnames[i];
            document.getElementById("projects").appendChild(opt);
        }
    }

    //open existing project
    function openProject() {
        var botName = document.getElementById("projects").value;
        window.open("graphpage?bot=" + botName, "_self");

    }

    //delete existing project
    function deleteProject() {
        var botName = document.getElementById("projects").value;
        $.post("delete-project", botName,
            function (data, status) {
                document.getElementById("projects").innerHTML = "";
                botnames = data.split(";");
                for (i = 0; i < botnames.length; i++) {
                    if (botnames[i] != "") {
                        var opt = document.createElement("option");
                        opt.value = botnames[i];
                        opt.innerHTML = botnames[i];
                        document.getElementById("projects").appendChild(opt);
                    }
                }
            });

    }

    function createProject() {
        console.log("creating new project");
        var botName = document.getElementById("newBotName").value;
        //jQuery.ajaxSetup({async: false});
        var formElement = document.getElementById("file-form");
        var request = new XMLHttpRequest();
        request.onreadystatechange = function () {
            if (request.readyState == XMLHttpRequest.DONE) {
                window.open("graphpage?bot=" + botName, "_self");
            }
        }
        console.log(request);
        request.open("POST", "upload");
        var formData = new FormData(formElement);
        formData.append('form', 'create_project'); //create_project or python
        request.send(formData);
        //jQuery.ajaxSetup({async: true});

    }
</script>

</body>
</html>