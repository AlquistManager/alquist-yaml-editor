<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Select Project</title>

    <script type="text/javascript" src="jquery-3.1.1.min.js"></script>
</head>
<body>

<p>Choose existing project to open:</p>
<select id="projects"></select>
<button type="button" onclick="openProject()">Open</button>
<br>
<p>Create a new project:</p>
<form id="file-form" method="POST" enctype=multipart/form-data>
    Bot name: <input type="text" id="newBotName" name="botname"><br>
    Add files:
    <input type="file" id="file" name="file" multiple size="50"><br>
    <button type="button" onclick="createProject()">Create Project</button>
</form>


<script type="text/javascript">
    var applicationURL = "http://thawing-escarpment-24517.herokuapp.com/update";//"http://thawing-escarpment-24517.herokuapp.com/update";
    var botnames;
    jQuery.ajaxSetup({async: false});
    $.post(applicationURL + "botnames", "getBotnames",
        function (data, status) {
            botnames = data.split(";");
            console.log("get bot names: " + status);
        });
    jQuery.ajaxSetup({async: true});

    for (i = 0; i < botnames.length; i++) {
        if (botnames[i] != "") {
            var opt = document.createElement("option");
            opt.value = botnames[i];
            opt.innerHTML = botnames[i];
            document.getElementById("projects").appendChild(opt);
        }
    }

    function openProject() {
        var botName = document.getElementById("projects").value;
        window.open("test_viz_js2.html?bot=" + botName, "_self");
    }

    function createProject() {
        console.log("creating new project");
        var botName = document.getElementById("newBotName").value;
        //jQuery.ajaxSetup({async: false});
        var formElement = document.getElementById("file-form");
        var request = new XMLHttpRequest();
        request.onreadystatechange = function () {
            if (request.readyState == XMLHttpRequest.DONE) {
                window.open("test_viz_js2.html?bot=" + botName, "_self");
            }
        }
        console.log(request);
        request.open("POST", applicationURL + "upload");
        request.send(new FormData(formElement));
        //jQuery.ajaxSetup({async: true});

    }
</script>

</body>
</html>